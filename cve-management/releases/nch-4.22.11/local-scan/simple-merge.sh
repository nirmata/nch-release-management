#!/bin/bash

set -euo pipefail

echo "Testing simple extraction..."

# Test vulnerability extraction for users
echo "Users vulnerabilities:"
jq -c '[
    .matches[] | {
        name: .artifact.name,
        installed: .artifact.version,
        fixed_in: (if .vulnerability.fix.versions and (.vulnerability.fix.versions | length > 0) then .vulnerability.fix.versions[0] else "" end),
        type: .artifact.type,
        vulnerability: .vulnerability.id,
        severity: .vulnerability.severity,
        epss: (if .vulnerability.epss then (.vulnerability.epss[0].percentile * 100 | tostring) + "%" else "N/A" end),
        risk: (if .vulnerability.risk then (.vulnerability.risk | tostring) else "N/A" end),
        published_date: "N/A"
    }
]' users-scan.json > users-vulns.json

echo "âœ… Users extraction complete"
cat users-vulns.json | jq '.[0]'
